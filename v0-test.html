<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V0å‰ç«¯APIé›†æˆæµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; }
        .config-section { margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff; }
        .test-section { margin-bottom: 20px; }
        .status { padding: 10px; border-radius: 6px; margin: 10px 0; font-weight: bold; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .code { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto; }
        .api-url { background: #e3f2fd; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; word-break: break-all; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #0056b3; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .metric { text-align: center; }
        .metric-value { font-size: 2em; color: #007bff; font-weight: bold; }
        .metric-label { color: #666; font-size: 0.9em; }
        .response-box { max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 6px; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš• GPSæ•°æ®API - V0å‰ç«¯é›†æˆæµ‹è¯•</h1>
            <p>æµ‹è¯•GitHub Pageséƒ¨ç½²çš„GPSå‡ºç§Ÿè½¦æ•°æ®API</p>
        </div>
        
        <!-- APIé…ç½® -->
        <div class="config-section">
            <h3>ğŸ”§ APIé…ç½®</h3>
            <label>GitHub Pages APIåœ°å€:</label>
            <input type="text" id="api-url-input" placeholder="https://YOUR-USERNAME.github.io/YOUR-REPO-NAME" 
                   style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px;">
            <button onclick="updateAPIUrl()">æ›´æ–°APIåœ°å€</button>
            <button onclick="testExampleAPI()">æµ‹è¯•ç¤ºä¾‹API</button>
            
            <div class="api-url">
                <strong>å½“å‰APIåœ°å€:</strong> <span id="current-api-url">æœªè®¾ç½®</span>
            </div>
        </div>
        
        <!-- è¿æ¥çŠ¶æ€ -->
        <div class="test-section">
            <h3>ğŸ“¡ è¿æ¥çŠ¶æ€</h3>
            <div id="connection-status" class="status loading">æ£€æŸ¥è¿æ¥ä¸­...</div>
            <button onclick="checkConnection()">é‡æ–°æ£€æŸ¥è¿æ¥</button>
        </div>
        
        <!-- APIæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ§ª APIç«¯ç‚¹æµ‹è¯•</h3>
            <div class="grid">
                <div class="card">
                    <h4>ğŸ“… æ—¥æœŸåˆ—è¡¨</h4>
                    <button onclick="testDatesAPI()">è·å–æ—¥æœŸ</button>
                    <div id="dates-result" class="metric">
                        <div class="metric-value" id="dates-count">-</div>
                        <div class="metric-label">å¯ç”¨æ—¥æœŸ</div>
                    </div>
                </div>
                
                <div class="card">
                    <h4>ğŸ—ºï¸ è½¨è¿¹æ•°æ®</h4>
                    <button onclick="testTrajectoryAPI()">è·å–è½¨è¿¹</button>
                    <div class="metric">
                        <div class="metric-value" id="points-count">-</div>
                        <div class="metric-label">GPSè½¨è¿¹ç‚¹</div>
                    </div>
                </div>
                
                <div class="card">
                    <h4>ğŸ“Š æ•°æ®æ‘˜è¦</h4>
                    <button onclick="testSummaryAPI()">è·å–æ‘˜è¦</button>
                    <div class="metric">
                        <div class="metric-value" id="summary-status">-</div>
                        <div class="metric-label">æ•°æ®æ¦‚å†µ</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- V0é›†æˆä»£ç  -->
        <div class="test-section">
            <h3>ğŸ’» V0å‰ç«¯é›†æˆä»£ç </h3>
            <p>å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°ä½ çš„V0å‰ç«¯é¡¹ç›®ä¸­ï¼š</p>
            
            <h4>React/Next.js Hook:</h4>
            <div class="code" id="react-code">// ç‚¹å‡»"æ›´æ–°APIåœ°å€"åè‡ªåŠ¨ç”Ÿæˆ</div>
            
            <h4>åŸç”ŸJavaScript:</h4>
            <div class="code" id="vanilla-code">// ç‚¹å‡»"æ›´æ–°APIåœ°å€"åè‡ªåŠ¨ç”Ÿæˆ</div>
        </div>
        
        <!-- APIå“åº” -->
        <div class="test-section">
            <h3>ğŸ“¥ APIå“åº”æ•°æ®</h3>
            <div class="response-box" id="api-response">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•APIï¼Œå“åº”æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>

    <script>
        let currentAPIUrl = '';
        
        function updateAPIUrl() {
            const input = document.getElementById('api-url-input');
            const url = input.value.trim();
            
            if (!url) {
                alert('è¯·è¾“å…¥GitHub Pages APIåœ°å€');
                return;
            }
            
            // éªŒè¯URLæ ¼å¼
            try {
                new URL(url);
            } catch (e) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€');
                return;
            }
            
            currentAPIUrl = url;
            document.getElementById('current-api-url').textContent = url;
            
            // ç”Ÿæˆé›†æˆä»£ç 
            generateIntegrationCode(url);
            
            // è‡ªåŠ¨æ£€æŸ¥è¿æ¥
            checkConnection();
        }
        
        function testExampleAPI() {
            document.getElementById('api-url-input').value = 'https://example-user.github.io/taxi-gps-api';
            updateAPIUrl();
        }
        
        async function checkConnection() {
            if (!currentAPIUrl) {
                document.getElementById('connection-status').innerHTML = '<div class="status error">è¯·å…ˆè®¾ç½®APIåœ°å€</div>';
                return;
            }
            
            const statusEl = document.getElementById('connection-status');
            statusEl.innerHTML = '<div class="status loading">æ£€æŸ¥è¿æ¥ä¸­...</div>';
            
            try {
                const response = await fetch(`${currentAPIUrl}/api/dates.json`, {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    statusEl.innerHTML = `<div class="status success">âœ… è¿æ¥æˆåŠŸï¼æ‰¾åˆ° ${data.dates ? data.dates.length : 0} ä¸ªå¯ç”¨æ—¥æœŸ</div>`;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusEl.innerHTML = `<div class="status error">âŒ è¿æ¥å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testDatesAPI() {
            if (!currentAPIUrl) {
                alert('è¯·å…ˆè®¾ç½®APIåœ°å€');
                return;
            }
            
            try {
                const response = await fetch(`${currentAPIUrl}/api/dates.json`);
                const data = await response.json();
                
                document.getElementById('dates-count').textContent = data.dates ? data.dates.length : 0;
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('dates-count').textContent = 'ERROR';
                document.getElementById('api-response').textContent = `é”™è¯¯: ${error.message}`;
            }
        }
        
        async function testTrajectoryAPI() {
            if (!currentAPIUrl) {
                alert('è¯·å…ˆè®¾ç½®APIåœ°å€');
                return;
            }
            
            try {
                const response = await fetch(`${currentAPIUrl}/data/taxi_data_2013-09-12.json`);
                const data = await response.json();
                
                document.getElementById('points-count').textContent = data.sampled || data.points?.length || 0;
                
                // åªæ˜¾ç¤ºå‰10ä¸ªç‚¹ï¼Œé¿å…å“åº”è¿‡å¤§
                const preview = {
                    ...data,
                    points: data.points ? data.points.slice(0, 10) : [],
                    note: data.points?.length > 10 ? `æ˜¾ç¤ºå‰10ä¸ªç‚¹ï¼Œå®é™…æœ‰${data.points.length}ä¸ªç‚¹` : ''
                };
                
                document.getElementById('api-response').textContent = JSON.stringify(preview, null, 2);
            } catch (error) {
                document.getElementById('points-count').textContent = 'ERROR';
                document.getElementById('api-response').textContent = `é”™è¯¯: ${error.message}`;
            }
        }
        
        async function testSummaryAPI() {
            if (!currentAPIUrl) {
                alert('è¯·å…ˆè®¾ç½®APIåœ°å€');
                return;
            }
            
            try {
                const response = await fetch(`${currentAPIUrl}/api/summary.json`);
                const data = await response.json();
                
                document.getElementById('summary-status').textContent = 'âœ… OK';
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('summary-status').textContent = 'âŒ ERR';
                document.getElementById('api-response').textContent = `é”™è¯¯: ${error.message}`;
            }
        }
        
        function generateIntegrationCode(apiUrl) {
            // React Hookä»£ç 
            const reactCode = `// React/Next.js Hook for GPS Data
import { useState, useEffect } from 'react';

const API_BASE_URL = '${apiUrl}';

export function useGPSData(date = '2013-09-12') {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch(\`\${API_BASE_URL}/data/taxi_data_\${date}.json\`);
        
        if (!response.ok) {
          throw new Error(\`HTTP \${response.status}\`);
        }
        
        const gpsData = await response.json();
        setData(gpsData);
        setError(null);
      } catch (err) {
        setError(err.message);
        console.error('GPSæ•°æ®è·å–å¤±è´¥:', err);
      } finally {
        setLoading(false);
      }
    };
    
    fetchData();
  }, [date]);
  
  return { data, loading, error };
}

// ä½¿ç”¨ç¤ºä¾‹
function GPSMap({ selectedDate }) {
  const { data, loading, error } = useGPSData(selectedDate);
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  if (!data) return <div>æ— æ•°æ®</div>;
  
  return (
    <div>
      <h3>GPSè½¨è¿¹ - {data.date}</h3>
      <p>è½¨è¿¹ç‚¹æ•°: {data.sampled}</p>
      {/* æ¸²æŸ“åœ°å›¾ç»„ä»¶ */}
      {data.points.map(([lng, lat, timestamp, flag], index) => (
        <MapMarker 
          key={index}
          lng={lng} 
          lat={lat}
          color={flag === 1 ? '#ff0000' : '#808080'}  // çº¢è‰²=è½½å®¢ï¼Œç°è‰²=ç©ºè½¦
        />
      ))}
    </div>
  );
}`;
            
            // åŸç”ŸJavaScriptä»£ç 
            const vanillaCode = `// åŸç”ŸJavaScript GPSæ•°æ®è·å–
const API_BASE_URL = '${apiUrl}';

// GPSæ•°æ®APIå®¢æˆ·ç«¯
class GPSDataClient {
  constructor() {
    this.cache = new Map();
  }
  
  async fetchWithCache(endpoint) {
    if (this.cache.has(endpoint)) {
      return this.cache.get(endpoint);
    }
    
    const response = await fetch(\`\${API_BASE_URL}\${endpoint}\`);
    if (!response.ok) {
      throw new Error(\`HTTP \${response.status}: \${response.statusText}\`);
    }
    
    const data = await response.json();
    this.cache.set(endpoint, data);
    return data;
  }
  
  async getTrajectoryData(date = '2013-09-12') {
    return this.fetchWithCache(\`/data/taxi_data_\${date}.json\`);
  }
  
  async getAvailableDates() {
    const data = await this.fetchWithCache('/api/dates.json');
    return data.dates;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const gpsClient = new GPSDataClient();

// è·å–å¹¶å¤„ç†GPSæ•°æ®
async function loadGPSData(date = '2013-09-12') {
  try {
    const data = await gpsClient.getTrajectoryData(date);
    console.log(\`è·å¾— \${data.sampled} ä¸ªGPSè½¨è¿¹ç‚¹\`);
    
    // å¤„ç†è½¨è¿¹æ•°æ®
    data.points.forEach(([lng, lat, timestamp, flag]) => {
      const status = flag === 1 ? 'è½½å®¢' : 'ç©ºè½¦';
      const color = flag === 1 ? '#ff0000' : '#808080';
      
      // æ·»åŠ åˆ°åœ°å›¾
      addMapMarker({ lng, lat, status, color });
    });
    
    return data;
  } catch (error) {
    console.error('GPSæ•°æ®åŠ è½½å¤±è´¥:', error);
    throw error;
  }
}

// è°ƒç”¨ç¤ºä¾‹
loadGPSData('2013-09-12')
  .then(data => console.log('æ•°æ®åŠ è½½æˆåŠŸ:', data.date))
  .catch(error => console.error('åŠ è½½å¤±è´¥:', error));`;
            
            document.getElementById('react-code').textContent = reactCode;
            document.getElementById('vanilla-code').textContent = vanillaCode;
        }
    </script>
</body>
</html>